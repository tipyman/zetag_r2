<xml xmlns="https://developers.google.com/blockly/xml"><variables></variables><block type="pxt-on-start" id=",!wL,`)hx1?wWUg4SxPz" x="0" y="0"><statement name="HANDLER"><block type="typescript_statement" id=";PINMz(TQb#[=%_u!lEB"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let i = 0" numlines="1" declaredvars="i"></mutation><next><block type="typescript_statement" id="}N/9%g=ei;/,AQ|rrN#w"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let buffer: Buffer = Buffer.create(0)" numlines="1" declaredvars="buffer"></mutation><next><block type="typescript_statement" id="8//Gb[RwQ*N[e5~_Tx.7"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="namespace ZETag{" line1="    let Para_array: number[] = []" line2="    let ch_spacing = 0" line3="    let CheckSum = 0" line4="    let o = 0" line5="    let TX_Power_data = 0" line6="    let ch_num = 0" line7="    let Base_frequency = 0" line8="    let Counter2 = 0" line9="    let data = 0" line10="" line11="    function Send_Uart_data(data_array: number[], num: number): void {" line12="        o = 0" line13="        for (let n = 0; n &lt;= num - 1; n++) {" line14="            binserial_write(data_array[n])" line15="            basic.pause(5)" line16="        }" line17="    }" line18="    function Receive_Uart_data() {" line19="        data = 0" line20="        buffer = serial.readBuffer(1)" line21="        for (let index = 0; index &lt; 100; index++) {" line22="            if (buffer.length &gt; 0) {" line23="                data = buffer.length" line24="                break;" line25="            }" line26="            basic.pause(10)" line27="        }" line28="        return data" line29="    }" line30="" line31="    function Receive_Query(cmd_data: number): boolean {" line32="        let rcv_buf: number[] = [0,0,0,0,0]" line33="        for (let index2 = 0; index2 &lt; 5; index2++) {" line34="            i = 0" line35="            let rcv_data = Receive_Uart_data()" line36="            if (rcv_data == 0) {" line37="                break;" line38="            }" line39="            rcv_buf [i] = rcv_data" line40="        }" line41="" line42="        if ((rcv_buf[0] == 0xff) &amp;&amp; (rcv_buf[1] == 0) &amp;&amp; (rcv_buf[2] == 2) &amp;&amp; (rcv_buf[3] == cmd_data)){" line43="            return true" line44="        }" line45="        else return false" line46="    }" line47="    " line48="    function binserial_write(text: number): void {" line49="        return;" line50="    }" line51="" line52="    /**" line53="     * set channel spacing" line54="     */" line55="    //% blockId=Channel_Spacing block=&quot;Set Channel Space %s (KHz)&quot;" line56="    //% weight=80 blockGap=8" line57="    //% CH_SPACE.min=100 CH_SPACE.max=200 CH_SPACE.defl=100" line58="    export function Set_channel_spacing(CH_SPACE: number): boolean {" line59="        // FF 00 03 F0 64 56; 100KHz設定" line60="        // FF+00+03+F0=1F2 -&gt; 0xf2" line61="        Send_Uart_data([" line62="            0xff, 0x00, 0x03, 0xf0, CH_SPACE," line63="            (0xf2 + ch_spacing) % 256       // CheckSum" line64="        ], 6)" line65="        return (Receive_Query(0xf1))" line66="    }" line67="" line68="    //% blockId=Send_data block=&quot;Send ZETag data %data_array %num&quot;" line69="    //% weight=80 blockGap=8" line70="    export function Send_data(data_array: number[], num: number): boolean {" line71="        // 0xff+2+0x80=0x181 -&gt; 0x81" line72="        // FF 00 02 80" line73="        CheckSum = 0x81 + num" line74="        Send_Uart_data([" line75="            0xff," line76="            0x00," line77="            num + 2," line78="            0x80" line79="        ], 4)" line80="        o = 0" line81="        for (let index22 = 0; index22 &lt; num; index22++) {" line82="            binserial_write(data_array[o])" line83="            basic.pause(5)" line84="            CheckSum = CheckSum + data_array[o]" line85="            o += 1" line86="        }" line87="        binserial_write(CheckSum % 256)" line88="        return (Receive_Query(0x80))" line89="    }" line90="" line91="    //% blockId=TX_Power block=&quot;TX Power %TX_Power (dB)&quot;" line92="    //% weight=80 blockGap=8" line93="    //% TX_Power.min=1 TX_Power.max=10 TX_Power.defl=10" line94="    export function Set_TX_Power(TX_Power: number): boolean{" line95="        TX_Power_data = TX_Power * 2" line96="        // FF 00 03 41 10 53; 出力8dB設定" line97="        // FF+00+03+41=0x143 -&gt; 0x43" line98="        Send_Uart_data([" line99="            0xff, 0x00, 0x03, 0x41, TX_Power_data," line100="            (0x43 + TX_Power_data) % 256  //CheckSum" line101="        ], 6)" line102="        return (Receive_Query(0x41))" line103="    }" line104="" line105="    //% blockId=Set_Frequency block=&quot;Set Frequency %Frequency (Hz) %CH_num (ch) %CH_step&quot;" line106="    //% weight=80 blockGap=8" line107="    //% CH_num.min=1 CH_num.max=6 CH_num.defl=2" line108="    //% CH_step.min=1 CH_step.max=2 CH_step.defl=2" line109="    export function Set_Frequency(Frequency: number, CH_num: number, CH_step: number): boolean {" line110="        o = CH_step" line111="        if (CH_num &lt;= 1) {" line112="            ch_num = -1" line113="        } else {" line114="            ch_num = CH_num" line115="        }" line116="        Base_frequency = Frequency" line117="        CheckSum = 0" line118="        Para_array = [" line119="            0xff, 0x00, 0x08 + ch_num, 0x40, 0x01," line120="            Math.idiv(Base_frequency, 16777216)," line121="            Math.idiv(Base_frequency, 65536) % 256," line122="            Math.idiv(Base_frequency, 256) % 256," line123="            Base_frequency % 256," line124="            ch_num," line125="            0, 0, 0, 0, 0, 0, 0" line126="        ]" line127="        if (ch_num &gt;= 2) {" line128="            for (let Counter = 0; Counter &lt;= ch_num - 1; Counter++) {" line129="                Para_array[10 + Counter] = Counter * o" line130="            }" line131="        } else {" line132="            Para_array[4] = 0" line133="        }" line134="        Counter2 = 0" line135="        for (let index222 = 0; index222 &lt; ch_num + 10; index222++) {  //CheckSum" line136="            CheckSum = CheckSum + Para_array[Counter2]" line137="            Counter2 += 1" line138="        }" line139="        CheckSum = CheckSum % 256" line140="        Para_array[10 + ch_num] = CheckSum" line141="        Send_Uart_data(Para_array, 11 + ch_num)" line142="        return (Receive_Query(0x40))" line143="    }" line144="}" numlines="145"></mutation></block></next></block></next></block></statement></block></xml>